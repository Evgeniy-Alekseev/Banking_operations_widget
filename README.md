# Banking operations widget

## Описание проекта

Проект предназначен для работы с банковскими операциями через виджет с функциями 
фильтрации, маскирования и генерации данных. В данный момент проект находится в разработке.
Проект разрабатывается в учебных целях, представлен на Github для ознакомления.

## Структура проекта

* `src/masks` - модуль отвечающий за маскировку данных;
* `src/processing` - модуль отвечающий за сортировку трансакций;
* `src/widget` - модуль содержащий основной функционал для работы с трансакциями;
* `src/generators` - модуль отвечающий за генерацию необходимых данных.
* `src/decorators` - модуль содержащий декоратор log, который может логировать 
                     работу функции и ее результат как в файл, так и в консоль
* `src/external_api` - модуль отвечающий за подсчет сумм трансакций в единой валюте;
* `src/utils` - модуль отвечающий за обработку данных из JSON-файлов;
* `src/utils_2` - модуль отвечающий за обработку данных из CSV-файла и из EXCEL-файла;
* `services` - модуль отвечающий за поиск и фильтрацию данных о трансакциях;

## Установка

Для пользователя:

```
poetry install --no-dev
```

Для разработчика:

```
poetry install
```

## Функционал

В проекте реализованы функции, для работы с клиентскими данными и обработки банковских операций, в частности:

- get_mask_card_number - Функция принимает на вход номер карты в виде числа и возвращает маску номера по правилу XXXX XX** **** XXXX;
- get_mask_account - Функция принимает на вход номер счета и возвращает маску номера по правилу **XXXX;
- mask_account_card - Функция работает с импортом функций get_mask_card_number и get_mask_account. 
                      Маскирует номер карты или счёта в переданной строке;
- get_date - Функция преобразует строку с датой в строку формата 'ДД.ММ.ГГГГ';
- filter_by_state - Функция фильтрует список словарей по значению ключа 'state' (по умолчанию 'EXECUTED').
                    Возвращает отфильтрованный список словарей;
- sort_by_date - Функция сортирует список словарей по дате (ключ 'date') (по умолчанию reverse = True).
                 Возвращает отсортированный список словарей (в начале новые записи);
- filter_by_currency - Функция фильтрует транзакции по валюте и возвращает итератор;
- transaction_descriptions - Генератор, который возвращает описания транзакций по запросу;
- card_number_generator - Генератор номеров банковских карт, генерирует номера от значений start до stop
    включительно, в формате XXXX XXXX XXXX XXXX.
- log - логирует работу функции и ее результат как в файл, так и в консоль.
- get_amount_in_rub - Возвращает сумму транзакции в рублях, если валюта не RUB, конвертирует по текущему курсу через API.
- load_transactions_json - Загружает список транзакций из JSON-файла и возвращает список словарей с транзакциями или 				   пустой список в случае ошибок.
- load_transactions_csv - Загружает список транзакций из CSV-файла и возвращает список словарей с транзакциями или пустой 			  список в случае ошибок.
- load_transactions_excel - Загружает список транзакций из EXCEL-файла и возвращает список словарей с транзакциями или 				    пустой список в случае ошибок.
- process_bank_search - Фильтрует список транзакций по строке поиска;
- process_bank_operations - Подсчитывает количество операций для каждой категории из списка;

## Тестирование

Проект покрыт комплексными тестами с использованием `pytest`. Тесты проверяют как основную функциональность, 
так и обработку граничных случаев. На основании проведённых тестов Code coverage покрытие составляет 81%.

### Тестовые модули

1. **Тесты фильтрации транзакций**:
   - Фильтрация по статусу (`EXECUTED`, `PENDING`, `CANCELED`)
   - Обработка транзакций без статуса
   - Работа с пустым списком транзакций
   - Реакция на некорректные входные данные
   - Фильтрация по заданной валюте

2. **Тесты сортировки по дате**:
   - Сортировка по возрастанию и убыванию
   - Обработка транзакций с одинаковыми датами
   - Работа с граничными значениями дат (минимальная/максимальная дата)
   - Обработка некорректных форматов даты

3. **Тесты маскировки данных**:
   - Корректная маскировка номеров счетов
   - Маскировка разных типов карт (Visa, MasterCard, МИР)
   - Обработка некорректных входных данных   
 
4. **Генератор номеров карт**:
   - Проверка генерации последовательности
   - Корректность форматирования
   - Обработка граничных значений
   - Проверка корректной фильтрации
   - Обработка отсутствующих данных
   - Параметризованные тесты для разных валют
 
5. **Тесты декоратора**
   - Тест для логирования в файл
   - Тест для логирования в консоль
   - Тест для проверки сохранения имени функции
   - Тест вызова с ошибкой
   
6. **Тесты выгрузки сумм операций**
   - Тест для выгрузки верной информации
   - Тест для перевода по курсу валют
   - Тест для проверки API-ключа

7. **Тесты загрузки данных по трнсакциям**
   - Тест для загрузки валидного файла
   - Тест для загрузки верной информации
   - Тест для отсутствующего файла загрузки
   - Тест для прав доступа к файлу

8. **Тесты фильтрации данных по трнсакциям**
   - Поиск с учётом регистра
   - Пустой поиск
   - Частичное совпадение
   - Спецсимволы в строке поиска
   - Отсутствие description в транзакции

### Запуск тестов

Для запуска тестов выполните команду:

```bash
pytest -v